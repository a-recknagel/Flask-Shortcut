
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flask-Shortcut documentation &#8212; Flask-Shortcut 0.4.0 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/flask.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/shortcut-logo-favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="flask_shortcut package" href="autodoc/flask_shortcut.html" />
  <script>DOCUMENTATION_OPTIONS.URL_ROOT = './';</script>
   
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="autodoc/flask_shortcut.html" title="flask_shortcut package"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Flask-Shortcut 0.4.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Flask-Shortcut documentation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="flask-shortcut-documentation">
<h1>Flask-Shortcut documentation<a class="headerlink" href="#flask-shortcut-documentation" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
</ul>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="autodoc/flask_shortcut.html">Module Content</a><ul>
<li class="toctree-l2"><a class="reference internal" href="autodoc/flask_shortcut.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="autodoc/flask_shortcut.html#module-flask_shortcut.shortcut">flask_shortcut.shortcut module</a></li>
<li class="toctree-l2"><a class="reference internal" href="autodoc/flask_shortcut.html#module-flask_shortcut.util">flask_shortcut.util module</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="project-description">
<h2>Project Description<a class="headerlink" href="#project-description" title="Permalink to this headline">¶</a></h2>
<p>This extension provides an easy and safe way to add dev-only shortcuts to
routes in your flask application.</p>
<p>The main beneficiaries are microservices that need to be tested regularly in
conjunction with their clients. If you need to assert working communication and
basic integration in a sufficiently complex ecosystem, clients that can not
freely chose how their requests are formed gain a lot from being able to
receive predictable responses. By skipping over the details of how the
microservice is implemented, which bugs and minor changes it experiences over
time, testing basic API compatibility gets a lot more manageable.</p>
<p>In a test-engineering context, it would be considered a “fake”.</p>
</div>
<div class="section" id="what-is-a-shortcut">
<h2>What is a Shortcut?<a class="headerlink" href="#what-is-a-shortcut" title="Permalink to this headline">¶</a></h2>
<p>In the context of this package, a shortcut is a condition-and-response pair.
The response is <a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/quickstart/#about-responses">anything that a view function can return</a>, and the
condition depends on one of the three possible mapping contexts.</p>
<p>In the first context, only the response is passed as the shortcut, and the
condition is assumed to always be true, effectively replacing the route to
always just return the given response. Showcased with the view <code class="docutils literal notranslate"><span class="pre">foo</span></code>
in the usage section.</p>
<p>In the second context, a dictionary that maps strings to responses is passed
as the shortcut. The strings need to be deserializeable as json, and the
first one that can be fully matched as a substructure into the request body
will see its condition as fulfilled, returning its associated response.
If none of them are valid sub-matches, the original view function will run.
Showcased with the view <code class="docutils literal notranslate"><span class="pre">bar</span></code> in the usage section.</p>
<p>In the third context, either a single function or a list of functions is
passed as the shortcut. The functions can run any code whatsoever and will
be executed one after the other as long as they return <code class="docutils literal notranslate"><span class="pre">None</span></code>, which means
that their condition is not fulfilled. As soon as one of them returns
something different, it is passed on as the response. If all of them return
<code class="docutils literal notranslate"><span class="pre">None</span></code>, the original view function is executed. Showcased with the view
<code class="docutils literal notranslate"><span class="pre">baz</span></code> in the usage section.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>You can add shortcuts to your view functions either individually with
decorators, or in a single swoop once all routes have been defined. Both ways
are functionally equivalent.</p>
</div>
</div>
<div class="section" id="applying-shortcuts">
<h1>Applying Shortcuts<a class="headerlink" href="#applying-shortcuts" title="Permalink to this headline">¶</a></h1>
<p><strong>With decorators:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask_shortcut</span> <span class="kn">import</span> <span class="n">Shortcut</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">short</span> <span class="o">=</span> <span class="n">Shortcut</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@short</span><span class="o">.</span><span class="n">cut</span><span class="p">((</span><span class="s1">&#39;short_foo&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;foo&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/bar&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@short</span><span class="o">.</span><span class="n">cut</span><span class="p">({</span>
    <span class="s1">&#39;{&quot;name&quot;: &quot;TestUser&quot;}&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;short_bar&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
    <span class="s1">&#39;{&quot;name&quot;: &quot;UserTest&quot;}&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;longer_bar&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
<span class="p">})</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;bar&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/baz&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@short</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;json_baz&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;json&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">mimetype</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">baz</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;baz&#39;</span>
</pre></div>
</div>
<p><strong>With a wire call</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask_shortcut</span> <span class="kn">import</span> <span class="n">Shortcut</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;foo&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/bar&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;bar&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/baz&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">baz</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;baz&#39;</span>

<span class="n">Shortcut</span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="o">.</span><span class="n">wire</span><span class="p">(</span>
    <span class="p">{</span>
         <span class="s1">&#39;/foo&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;short_foo&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="s1">&#39;/bar&#39;</span><span class="p">:</span> <span class="p">{</span>
             <span class="s1">&#39;{&quot;name&quot;: &quot;TestUser&quot;}&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;short_bar&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
             <span class="s1">&#39;{&quot;name&quot;: &quot;UserTest&quot;}&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;longer_bar&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="p">}</span>
         <span class="s1">&#39;/baz&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;json_baz&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;json&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">mimetype</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="what-it-looks-like">
<h1>What it looks like<a class="headerlink" href="#what-it-looks-like" title="Permalink to this headline">¶</a></h1>
<p>To showcase how the shortcuts are supposed to work, here is the result
of a couple of requests sent against the server from the example above
if it were run with <code class="docutils literal notranslate"><span class="pre">FLASK_ENV=test</span> <span class="pre">flask</span> <span class="pre">run</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">request</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:5000/foo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="go">&#39;short_foo&#39;  # the only response this route will give</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:5000/bar&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;me&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
<span class="go">&#39;bar&#39;  # no shortcut match -&gt; the original logic was executed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:5000/bar&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TestUser&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
<span class="go">&#39;short_bar&#39;  # shortcut match</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:5000/bar&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;UserTest&quot;</span><span class="p">,</span> <span class="s2">&quot;job&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
<span class="go">&#39;longer_bar&#39;  # shortcut only needs to be contained for a match</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:5000/baz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="go">&#39;baz&#39;  # no shortcut match -&gt; the function returned None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:5000/baz&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;me&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
<span class="go">&#39;json_baz&#39;  # shortcut matched -&gt; the function returned a valid response</span>
</pre></div>
</div>
<p>One focus of this package is that a production deployment would remain
as ignorant as possible about the existence of shortcuts. While the
shortcut object is still created, it only delegates the view functions
and no shortcut code has any chance of being executed, or showing up in
stack traces.</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Shortcuts will only be applied when <code class="docutils literal notranslate"><span class="pre">FLASK_ENV</span></code> is set to something
different from its default setting, <code class="docutils literal notranslate"><span class="pre">production</span></code>. You can extend that list
through the <code class="docutils literal notranslate"><span class="pre">SHORTCUT_EXCLUSIONS</span></code> config setting, either by adding it to
your app’s config before creating any Shortcut objects, or preferably by
setting up the whole config <a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/config/#configuring-from-files">with a file</a>.</p>
<p>Possible values for it are all environments that you want to block other
than <code class="docutils literal notranslate"><span class="pre">production</span></code> separated by commas. For example <code class="docutils literal notranslate"><span class="pre">staging,master</span></code> will
block the envs <code class="docutils literal notranslate"><span class="pre">production</span></code>, <code class="docutils literal notranslate"><span class="pre">staging</span></code>, and <code class="docutils literal notranslate"><span class="pre">master</span></code> from receiving
shortcuts.</p>
<hr class="docutils" />
<p>Project home is <a class="reference external" href="https://github.com/a-recknagel/Flask-Shortcut">on github</a>.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="#">
              <img class="logo" src="_static/shortcut-logo-narrow.png" alt="Logo"/>
            </a></p>
  

  <h3>Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Flask-Shortcut documentation</a><ul>
<li><a class="reference internal" href="#project-description">Project Description</a></li>
<li><a class="reference internal" href="#what-is-a-shortcut">What is a Shortcut?</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#applying-shortcuts">Applying Shortcuts</a></li>
<li><a class="reference internal" href="#what-it-looks-like">What it looks like</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul>
  <li><a href="#">Overview</a>
    <ul>
          
          <li>Next: <a href="autodoc/flask_shortcut.html" title="next chapter">flask_shortcut package</a>
    </ul>
  </li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Arne.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.3.
    </div>
  <script src="_static/version_warning_offset.js"></script>

  </body>
</html>